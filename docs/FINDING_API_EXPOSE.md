# 「APIの公開」メニューの見つけ方

Azure Portalで「APIの公開」メニューが見つからない場合の詳細ガイドです。

---

## 問題: 「APIの公開」が見つからない

よくある状況:
- ❌ 左メニューに「APIの公開」が表示されない
- ❌ どこを探してもそれらしいメニューがない
- ❌ 英語表示で違う名前になっている

---

## 解決方法

### 方法1: 正しい場所を確認（最も重要）

「APIの公開」は**App Registration（アプリの登録）の中**にあります。

#### ステップバイステップ

**1. Azure Portalのトップページから開始**

```
https://portal.azure.com
```

**2. Microsoft Entra ID を検索**

画面上部の検索バーに入力:
```
Microsoft Entra ID
```

または

```
Azure Active Directory
```

**3. Microsoft Entra ID を開く**

検索結果から「Microsoft Entra ID」をクリック

**4. 左メニューから「アプリの登録」を選択**

```
Microsoft Entra ID
├── 概要
├── ユーザー
├── グループ
├── アプリの登録 ← ここをクリック
├── エンタープライズ アプリケーション
└── ...
```

**5. 作成したアプリをクリック**

アプリ一覧から、作成したアプリ（例: `teams-leave-bot`）をクリック

**6. ここで初めて「APIの公開」が表示される**

```
teams-leave-bot (アプリの登録の詳細画面)
├── 概要
├── クイック スタート
├── ブランド
├── 認証
├── 証明書とシークレット
├── APIの公開 ← ★ここにあります！
├── APIのアクセス許可
├── 所有者
└── ...
```

---

## 画面構造の理解

### 間違った場所（よくある間違い）

❌ **Azure Portal トップレベルで探している**
```
Azure Portal
├── すべてのサービス
├── リソース グループ
├── すべてのリソース
└── APIの公開 ← ここにはありません！
```

❌ **Azure Bot の中で探している**
```
Azure Bot リソース
├── 概要
├── チャネル
├── 構成
└── APIの公開 ← ここにはありません！
```

✅ **正しい場所**
```
Azure Portal
└── Microsoft Entra ID
    └── アプリの登録
        └── teams-leave-bot（作成したアプリ）
            └── APIの公開 ← ★ここです！
```

---

## 詳細な画面遷移

### 画面1: Azure Portalトップ

```
┌─────────────────────────────────────────────────────┐
│ 🔍 [検索バーに「Microsoft Entra ID」と入力]        │
├─────────────────────────────────────────────────────┤
│                                                      │
│  Azure サービス                                      │
│  ┌──────┐ ┌──────┐ ┌──────┐                      │
│  │ VM   │ │Storage│ │ SQL  │ ...                  │
│  └──────┘ └──────┘ └──────┘                      │
│                                                      │
│  最近のリソース                                      │
│  - teams-leave-bot (Azure Bot)                      │
│  - ...                                              │
└─────────────────────────────────────────────────────┘
```

### 画面2: 検索結果

```
┌─────────────────────────────────────────────────────┐
│ 🔍 Microsoft Entra ID                               │
├─────────────────────────────────────────────────────┤
│                                                      │
│  検索結果                                            │
│                                                      │
│  📁 Microsoft Entra ID (サービス)  ← クリック       │
│     ディレクトリ サービス                            │
│                                                      │
│  📁 Azure Active Directory                          │
│     (同じもの・旧名)                                 │
└─────────────────────────────────────────────────────┘
```

### 画面3: Microsoft Entra ID 概要

```
┌─────────────────────────────────────────────────────┐
│ Microsoft Entra ID                                  │
├────────────────┬────────────────────────────────────┤
│ 管理           │ 概要                               │
│                │                                     │
│ 概要           │ テナント名: Default Directory      │
│ ユーザー       │ テナントID: aaaa-bbbb-cccc...      │
│ グループ       │                                     │
│ 外部ID         │ クイックタスク                      │
│ ロール         │ ┌─────────────────────┐          │
│ アプリの登録 ←│ │ユーザーの作成       │          │
│ エンタープライズ│ │グループの作成       │          │
│ デバイス       │ │アプリの登録 ←クリック│          │
│ ...            │ └─────────────────────┘          │
└────────────────┴────────────────────────────────────┘
```

### 画面4: アプリの登録 一覧

```
┌─────────────────────────────────────────────────────┐
│ アプリの登録                            + 新規登録   │
├─────────────────────────────────────────────────────┤
│                                                      │
│  すべてのアプリケーション  自分が所有  削除済み      │
│  ───────────────────────────────────────────        │
│                                                      │
│  表示名              アプリケーションID              │
│  teams-leave-bot     12345678-1234...  ← クリック   │
│  other-app           87654321-4321...               │
│  ...                                                 │
└─────────────────────────────────────────────────────┘
```

### 画面5: アプリの詳細（ここに「APIの公開」がある）

```
┌─────────────────────────────────────────────────────┐
│ teams-leave-bot                                     │
├────────────────┬────────────────────────────────────┤
│ 管理           │ 概要                               │
│                │                                     │
│ 概要           │ アプリケーション(クライアント)ID   │
│ クイックスタート│ 12345678-1234-1234-1234-123456... │
│ ブランド        │                                    │
│ 認証           │ ディレクトリ(テナント)ID            │
│ 証明書とシーク │ aaaaaaaa-aaaa-aaaa-aaaa-aaaa...    │
│ レット         │                                     │
│ APIの公開 ←★  │ サポートされているアカウントの種類  │
│ APIのアクセス  │ 任意の組織ディレクトリ内のアカウン │
│ 許可           │ ト (マルチテナント)                 │
│ 所有者         │                                     │
│ ロールと管理者 │                                     │
│ マニフェスト   │                                     │
└────────────────┴────────────────────────────────────┘
```

---

## 言語による表示の違い

Azure Portalの表示言語によって名称が異なります:

### 日本語表示
```
APIの公開
```

### 英語表示
```
Expose an API
```

### 他の言語
- 中国語（簡体字）: 公开 API
- 韓国語: API 노출
- フランス語: Exposer une API
- ドイツ語: API verfügbar machen

---

## 言語設定を変更して探す

### 方法: Azure Portalの言語を変更

1. 画面右上の⚙️（設定）アイコンをクリック
2. 「言語 + 地域」を選択
3. 言語を「English」に変更
4. 「適用」をクリック
5. ページを再読み込み

英語表示で「Expose an API」を探すと見つかりやすい場合があります。

---

## 直接URLでアクセス（高度な方法）

### URLの構造

```
https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/ExposeAnAPI/appId/{YOUR_APP_ID}/isMSAApp~/false
```

### 手順

1. Application (client) IDをコピー
   ```
   例: 12345678-1234-1234-1234-123456789abc
   ```

2. 以下のURLの `{YOUR_APP_ID}` を置き換え
   ```
   https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/~/ExposeAnAPI/appId/12345678-1234-1234-1234-123456789abc/isMSAApp~/false
   ```

3. ブラウザでこのURLを開く

→ 直接「APIの公開」ページが開きます

---

## よくある問題と解決方法

### 問題1: 左メニューに「APIの公開」が表示されない

**原因:**
- 間違った場所（Azure Bot リソースやMicrosoft Entra IDのトップページ）を見ている
- App Registrationの中に入っていない

**解決:**
```
正しい場所:
Microsoft Entra ID
→ アプリの登録
→ 作成したアプリ（teams-leave-bot）
→ 左メニューの「APIの公開」
```

### 問題2: 「アプリの登録」が見つからない

**原因:**
- Microsoft Entra IDのページに移動していない

**解決:**
1. Azure Portal トップページ
2. 検索バーで「Microsoft Entra ID」を検索
3. サービスをクリック
4. 左メニューから「アプリの登録」

### 問題3: 権限がないと表示される

**原因:**
- Azure ADで適切な権限がない

**解決:**
- 全体管理者（Global Administrator）に依頼
- または「アプリケーション管理者」ロールを付与してもらう

---

## チェックリスト

「APIの公開」にたどり着けているか確認:

- [ ] Azure Portal にログインしている
- [ ] Microsoft Entra ID ページを開いている
- [ ] 左メニューから「アプリの登録」をクリックしている
- [ ] 作成したアプリ（teams-leave-bot）をクリックしている
- [ ] アプリの詳細ページの左メニューを見ている
- [ ] 「APIの公開」または「Expose an API」が表示されている

すべてチェックできたら、次のステップに進めます！

---

## 実際の手順（まとめ）

### 完全な手順

```
1. https://portal.azure.com にアクセス

2. 画面上部の検索バーに入力:
   「Microsoft Entra ID」

3. 検索結果から「Microsoft Entra ID」をクリック

4. 左側のメニューから「アプリの登録」をクリック

5. アプリ一覧から「teams-leave-bot」をクリック
   （作成したアプリ名）

6. 左側のメニューを下にスクロール

7. 「APIの公開」をクリック

8. 画面が開いたら成功！
```

---

## スクリーンショット代わりのASCII図

### 最終的に開くべき画面

```
┌──────────────────────────────────────────────────────┐
│ teams-leave-bot > APIの公開                          │
├──────────────────────────────────────────────────────┤
│                                                       │
│ アプリケーション ID URI                               │
│ ┌───────────────────────────────────────────────┐   │
│ │ 未定義                                        │   │
│ │                                       [追加]  │   │
│ └───────────────────────────────────────────────┘   │
│                                                       │
│ このアプリケーションによって定義されるスコープ          │
│ ┌───────────────────────────────────────────────┐   │
│ │ スコープが定義されていません                   │   │
│ └───────────────────────────────────────────────┘   │
│                                                       │
│ 承認済みのクライアント アプリケーション                │
│ ┌───────────────────────────────────────────────┐   │
│ │ 承認済みのアプリケーションはありません          │   │
│ └───────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────┘
```

この画面が表示されていれば正しい場所です！

---

## 次のステップ

✅ 「APIの公開」ページが開けたら:

1. 「アプリケーション ID URI」の「追加」ボタンをクリック
2. 表示された値を `api://botid-{YOUR_APP_ID}` に変更
3. 保存

詳細は [AZURE_SETUP_MULTITENANT.md](../AZURE_SETUP_MULTITENANT.md) に戻ってください。

---

## まだ見つからない場合

以下の情報を確認してください:

1. **Azure Portal のURL**
   ```
   https://portal.azure.com
   ```
   （他のポータルではありません）

2. **正しいアカウントでログイン**
   - アプリを作成したAzureアカウント
   - 適切な権限があるアカウント

3. **正しいディレクトリ（テナント）**
   - 画面右上のアカウント名をクリック
   - 「ディレクトリの切り替え」で確認

それでも見つからない場合は、Azure管理者に相談してください。

---

**最終更新**: 2025-01-10
